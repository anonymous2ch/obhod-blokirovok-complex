# obhod-blokirovok-complex

Описание конфигурации
======================

Физические устройства:
----------------------

Приличная страна без путина и роскомнадзора:

1. Сервер (gentoo), внешний IP этого сервера: `188.1.2.3`. На нём запущены: `squid`, `polipo`, `tor`, `i2p`, `openvpn`, `strongswan`, `bird`, `dnsmasq` и `dante`
2. Сервер от https://tunnelbroker.net который предоставляет `6to4` туннели

Моя квартира:

1. Роутер [mikrotik hAP](https://mikrotik.com/product/RB951Ui-2nD), внешний IP, предоставленный российским провайдером: `41.4.5.6`
2. Комп стационарный (Windows) подключенный к роутеру через ethernet-кабель
3. Мои ноутбуки, телефоны и прочее вайфае-говно, подключенное по воздуху с WPA2-PSK авторизацией
4. Устройства гостей соседей и прочих майоров, подключенные по бесплатному wi-fi без авторизации

Квартира друга:

1. Комп (windows) подключенный к обычному интеренету через обычный роутер. На комп установлен OpenVPN с прилагаемым конфигом, внешний IP не нужен, никаких требований особых нет.

Прочее:

1. Телефон на Android, с установленным [StrongSwan VPN](https://play.google.com/store/apps/details?id=org.strongswan.android)
2. Телефон с установленным Telegram

Адреса сетей и интерфейсов:
---------------------------

Физические IPv4:

1. Внутреняя сеть устройств моей квартиры (роутером которой выступает тот самый mikrotik), wi-fi и ethernet объединены в мост, адрес интерфейса на роутере: `192.168.123.1`, подсеть `192.168.123.0/24`
2. Бесплатный вайфай для людей, адрес интерфейса `10.123.123.1`, изолированная подсеть `10.123.123.0/24`
3. Внешний белый статический IPv4-адрес, выданный роутеру mikrotik провайдером: `41.4.5.6`
4. Внешний белый статический IPv4-адрес сервера в приличной стране: `188.1.2.3`, linux device name: `eth0`

IPv6:

1. Внутреняя сеть устройств моей квартиры - адрес интерфейса на роутере: `2001:470:abcd:2::1/64`, подсеть `2001:470:abcd:2::/64`
2. Бесплатный вайфай для людей, адрес интерфейса `2001:470:abcd:1::1/64`, изолированная подсеть `2001:470:abcd:1::/64`
3. Туннель `6to4` на роутере mikrotik, адрес на роутере IPv6:`2001:470:11:678::2/64`, IPv4:`41.4.5.6`, адрес шлюза у tunnelbroker.net IPv6:`2001:470:11:678::1`, IPv4:`216.66.80.90`, префикс `2001:470:abcd::/48`, префикс `2001:470:12:678::/64`
4. Туннель `6to4` на сервере в приличной стране вместо нативного ipv6 (в whois которого за каким-то хером написана ФИО клиента), linux device name: `he-ipv6`, адрес интерфейса: IPv6:`2001:470:1001:123::2/64`, IPv4:`188.1.2.3`, адрес шлюза у tunnelbroker.net IPv6:`2001:470:1001:123::1/64`, IPv4:`216.66.80.30`, префикс: `2001:470:1002:123::/64`

Виртуальные сети и туннели:

1. Сеть между роутером mikrotik и сервером в приличной стране (linux device name: `tunipsec`), технология GRE over IPSsec (`strongswan`), адрес сервера: `192.168.222.1`, адрес микротика: `192.168.222.2`, маска подсети `255.255.255.0`
2. Сеть между сервером `OpenVPN` (адрес: `10.222.1.1`, linux device name: `tunopenvpn`) и его клиентами (`10.222.1.10-254`), маска `10.222.1.0/24`
3. Сеть между мобильным телефоном c установленным strongswan vpn и сервером в приличной стране (`10.0.1.0/24`)

Служебные адреса:

1. Виртуальный адрес для работы с tor/i2p: `123.123.123.123`


Вводная для чтения конфигов у вас теперь есть...

TODO: Описание принципов работы и однострочники на bash/ansible, позволяющие всё это развернуть за 5 минут
